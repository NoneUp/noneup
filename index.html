<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>–ì—Ä–∞ 2048</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #121212;
            color: white;
            height: 100vh;
            overflow-x: hidden;
            position: relative;
            transition: background 0.3s, color 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        body.light {
            background: #f5f5f5;
            color: #222;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –≥—Ä–∏ 2048 */
        h1 { margin-bottom: 10px; }
        .info { margin-bottom: 15px; font-size: 18px; }

        .grid {
            display: grid;
            grid-template-columns: repeat(4, 80px);
            grid-gap: 10px;
            background: #bbada0;
            padding: 10px;
            border-radius: 10px;
        }

        .tile {
            width: 80px;
            height: 80px;
            background: #cdc1b4;
            font-size: 24px;
            font-weight: bold;
            color: #776e65;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 5px;
            transition: background 0.2s ease;
        }

        .tile[data-val='2']    { background: #eee4da; }
        .tile[data-val='4']    { background: #ede0c8; }
        .tile[data-val='8']    { background: #f2b179; color: #fff; }
        .tile[data-val='16']   { background: #f59563; color: #fff; }
        .tile[data-val='32']   { background: #f67c5f; color: #fff; }
        .tile[data-val='64']   { background: #f65e3b; color: #fff; }
        .tile[data-val='128']  { background: #edcf72; color: #fff; }
        .tile[data-val='256']  { background: #edcc61; color: #fff; }
        .tile[data-val='512']  { background: #edc850; color: #fff; }
        .tile[data-val='1024'] { background: #edc53f; color: #fff; }
        .tile[data-val='2048'] { background: #edc22e; color: #fff; }

        .btn {
            margin-top: 10px;
            padding: 8px 16px;
            font-size: 16px;
            background: #8f7a66;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #game-over {
            margin-top: 20px;
            font-size: 22px;
            color: red;
            font-weight: bold;
        }

        @media (max-width: 500px) {
            .grid {
                grid-template-columns: repeat(4, 60px);
                grid-gap: 8px;
            }

            .tile {
                width: 60px;
                height: 60px;
                font-size: 18px;
            }
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ç–∞ –º–æ–¥–∞–ª–æ–∫ */
        #topButtons {
            position: fixed;
            top: 10px;
            left: 10px;
            display: flex;
            gap: 10px;
            z-index: 3000;
        }
        button {
            background: #444;
            border: none;
            border-radius: 5px;
            padding: 6px 12px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            user-select: none;
            display: flex;
            align-items: center;
            position: relative;
        }
        button:hover {
            background: #666;
        }
        button:focus {
            outline: 2px solid #aaa;
        }
        #settingsBtn {
            font-size: 18px;
            width: 34px;
            justify-content: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: clip;
            padding: 0;
        }
        #settingsBtn span {
            display: block;
            width: 100%;
            text-align: center;
        }

        /* –ù–æ–≤–∞ —Å—Ç–∏–ª—ñ –¥–ª—è –∫–Ω–æ–ø–∫–∏ Play/Pause –∑–≤–µ—Ä—Ö—É */
        #playPauseBtnTop {
            font-size: 18px; /* –†–æ–∑–º—ñ—Ä –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º */
            width: 34px;
            justify-content: center;
            padding: 0;
            display: none; /* –ü—Ä–∏—Ö–æ–≤–∞–Ω–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º */
            box-sizing: border-box;
        }
        #playPauseBtnTop span {
            display: block;
            width: 100%;
            text-align: center;
            line-height: 1;
        }
        #playPauseBtnTop.play-icon {
            font-size: 20px; /* –¢—Ä–∏–∫—É—Ç–Ω–∏–∫ –º–æ–∂–µ –±—É—Ç–∏ —Ç—Ä–æ—Ö–∏ –±—ñ–ª—å—à–∏–º */
        }
        #playPauseBtnTop.pause-icon {
            font-size: 16px; /* –î–≤—ñ –ø–∞–ª–∏—á–∫–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –º–µ–Ω—à–∏–º–∏ */
        }


        /* –ú–æ–¥–∞–ª–∫–∏ */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2500;
            padding: 20px;
        }
        .modal {
            background: #222;
            border-radius: 10px;
            max-width: 400px;
            width: 100%;
            padding: 20px 20px 20px 20px;
            position: relative;
            box-shadow: 0 0 20px #000;
            color: white;
            box-sizing: border-box;
        }
        body.light .modal {
            background: #fff;
            color: #222;
            box-shadow: 0 0 20px #aaa;
        }

        .modal h2 {
            margin-top: 0;
            margin-right: 40px;
            word-break: break-word;
        }

        .close-btn {
            position: absolute;
            right: 15px;
            top: 10px;
            font-size: 26px;
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            user-select: none;
            line-height: 1;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .close-btn:hover {
            color: #ccc;
        }
        body.light .close-btn {
            color: #222;
        }
        body.light .close-btn:hover {
            color: #555;
        }

        /* –û–Ω–æ–≤–ª–µ–Ω–∏–π —Å—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –≤ –º–æ–¥–∞–ª—Ü—ñ –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è */
        #controlsBackBtn {
            right: 10px; /* –ó–º—ñ–Ω–µ–Ω–æ –¥–ª—è –∫—Ä–∞—â–æ–≥–æ —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è */
            top: 10px;
            font-size: 24px; /* –ó–±—ñ–ª—å—à–µ–Ω–∏–π —Ä–æ–∑–º—ñ—Ä —Å—Ç—Ä—ñ–ª–∫–∏ */
            position: absolute;
            color: white;
            background: transparent;
            border: none;
            cursor: pointer;
            user-select: none;
            padding: 0; /* –í–∞–∂–ª–∏–≤–æ: –ø—Ä–∏–±—Ä–∞—Ç–∏ –±—É–¥—å-—è–∫—ñ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ –≤—ñ–¥—Å—Ç—É–ø–∏ */
            width: 34px; /* –ó—Ä–æ–±–∏—Ç–∏ —ó—ó —Å–ø—ñ–≤—Ä–æ–∑–º—ñ—Ä–Ω–æ—é –∑ —ñ–Ω—à–∏–º–∏ –≤–µ—Ä—Ö–Ω—ñ–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏ */
            height: 34px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-sizing: border-box; /* –í—Ä–∞—Ö—É–≤–∞—Ç–∏ padding —É –∑–∞–≥–∞–ª—å–Ω–æ–º—É —Ä–æ–∑–º—ñ—Ä—ñ */
        }
        body.light #controlsBackBtn {
            color: #222;
        }
        body.light #controlsBackBtn:hover {
            color: #555;
        }

        .mini-popup {
            position: absolute;
            top: 38px;
            left: 0;
            background: #222;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.7);
            padding: 10px;
            display: none;
            flex-direction: column;
            gap: 8px;
            min-width: 130px;
            z-index: 4000;
        }
        body.light .mini-popup {
            background: #eee;
            color: #222;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
        }
        .mini-popup button {
            background: transparent;
            color: inherit;
            padding: 6px 10px;
            border-radius: 5px;
            text-align: left;
        }
        .mini-popup button:hover {
            background: #555;
            color: white;
        }
        body.light .mini-popup button:hover {
            background: #ccc;
            color: #222;
        }
    </style>
</head>
<body>

    <div id="topButtons">
        <button id="rulesBtn" data-lang-key="rulesButton">?</button>
        <button id="playPauseBtnTop" title="–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏/–ü–∞—É–∑–∞"><span aria-hidden="true"></span></button>
        <button id="settingsBtn" title="–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è"><span aria-hidden="true">&#9881;</span></button>
    </div>

    <h1 data-lang-key="gameTitle">2048</h1>
    <div class="info"><span data-lang-key="scoreLabel">–û—á–∫–∏</span>: <span id="score">0</span> | <span data-lang-key="bestLabel">–†–µ–∫–æ—Ä–¥</span>: <span id="best">0</span></div>
    <div class="grid" id="grid"></div>
    <button class="btn" id="start" data-lang-key="startButton">–ì—Ä–∞—Ç–∏</button>
    <div id="game-over"></div>

    <div id="rulesModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="rulesTitle">
        <div class="modal">
            <button class="close-btn" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">&times;</button>
            <h2 id="rulesTitle" data-lang-key="rulesTitle">–ü—Ä–∞–≤–∏–ª–∞ –≥—Ä–∏ 2048</h2>
            <p><strong data-lang-key="pcLabel">–ù–∞ –ü–ö:</strong> <span data-lang-key="pcControls">–∫–µ—Ä—É–π –≥—Ä–æ—é –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å—Ç—Ä—ñ–ª–æ–∫: ‚Üê ‚Üë ‚Üí ‚Üì –∞–±–æ WASD.</span></p>
            <p><strong data-lang-key="phoneLabel">–ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—ñ:</strong> <span data-lang-key="phoneControls">–∫–µ—Ä—É–π –≥—Ä–æ—é —Å–≤–∞–π–ø–∞–º–∏ –≤–≥–æ—Ä—É, –≤–Ω–∏–∑, –≤–ª—ñ–≤–æ —Ç–∞ –≤–ø—Ä–∞–≤–æ.</span></p>
            <p><span data-lang-key="gameGoal">–ó'—î–¥–Ω—É–π –æ–¥–Ω–∞–∫–æ–≤—ñ —á–∏—Å–ª–∞, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ 2048 —ñ –≤–∏–≥—Ä–∞—Ç–∏ –≥—Ä—É!</span></p>
        </div>
    </div>

    <div id="settingsModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
        <div class="modal">
            <button class="close-btn" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">&times;</button>
            <h2 id="settingsTitle" data-lang-key="settingsTitle">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h2>
            <button id="controlsBtn" style="margin-top: 15px;" data-lang-key="controlsButton">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è</button>
            <div style="margin-top: 20px;">
                <div style="position: relative; margin-bottom: 15px;">
                    <button id="langBtn" data-lang-key="languageButton">–ú–æ–≤–∞ ‚ñº</button>
                    <div id="langPopup" class="mini-popup" role="listbox" aria-label="–í–∏–±—ñ—Ä –º–æ–≤–∏">
                        <button data-lang="zh">‰∏≠Êñá (–ö–∏—Ç–∞–π—Å—å–∫–∞)</button>
                        <button data-lang="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</button>
                        <button data-lang="ja">Êó•Êú¨Ë™û (–Ø–ø–æ–Ω—Å—å–∫–∞)</button>
                        <button data-lang="en">English</button>
                    </div>
                </div>
                <div style="position: relative;">
                    <button id="themeBtn" data-lang-key="themeButton">–¢–µ–º–∞ ‚ñº</button>
                    <div id="themePopup" class="mini-popup" role="listbox" aria-label="–í–∏–±—ñ—Ä —Ç–µ–º–∏">
                        <button data-theme="dark" data-lang-key="darkTheme">–¢–µ–º–Ω–∞ —Ç–µ–º–∞</button>
                        <button data-theme="light" data-lang-key="lightTheme">–°–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="controlsModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="controlsTitle">
        <div class="modal">
            <button id="controlsBackBtn" aria-label="–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è">‚Üê</button>
            <h2 id="controlsTitle" data-lang-key="controlsTitle">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è</h2>
            <p><strong data-lang-key="pcLabel">–ü–ö:</strong></p>
            <ul>
                <li><span data-lang-key="arrows">–°—Ç—Ä—ñ–ª–∫–∏: ‚Üê ‚Üë ‚Üí ‚Üì</span></li>
            </ul>
            <p><strong data-lang-key="phoneLabel">–¢–µ–ª–µ—Ñ–æ–Ω:</strong></p>
            <ul>
                <li><span data-lang-key="swipes">–°–≤–∞–π–ø–∏ –≤–≥–æ—Ä—É, –≤–Ω–∏–∑, –≤–ª—ñ–≤–æ, –≤–ø—Ä–∞–≤–æ</span></li>
            </ul>
        </div>
    </div>

    <script>
        // JS –¥–ª—è –≥—Ä–∏ 2048
        const grid = document.getElementById("grid");
        const scoreDisplay = document.getElementById("score");
        const bestDisplay = document.getElementById("best");
        const gameOverDisplay = document.getElementById("game-over");

        const startBtn = document.getElementById("start"); // –ö–Ω–æ–ø–∫–∞ "–ì—Ä–∞—Ç–∏" –≤–Ω–∏–∑—É
        const playPauseBtnTop = document.getElementById("playPauseBtnTop"); // –Ñ–¥–∏–Ω–∞ –∫–Ω–æ–ø–∫–∞ Play/Pause –∑–≤–µ—Ä—Ö—É

        let size = 4;
        let tiles = [];
        let paused = true; // –ì—Ä–∞ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –Ω–∞ –ø–∞—É–∑—ñ
        let gameStarted = false; // –ß–∏ –≥—Ä–∞ –±—É–ª–∞ —Ö–æ—á–∞ –± —Ä–∞–∑ –∑–∞–ø—É—â–µ–Ω–∞
        let gameOver = false; // –ß–∏ –≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (–ø—Ä–æ–≥—Ä–∞—à –∞–±–æ –≤–∏–≥—Ä–∞—à)
        let currentScore = 0;

        // –§—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –∫–µ—Ä—É—î –≤–∏–¥–∏–º—ñ—Å—Ç—é —Ç–∞ —ñ–∫–æ–Ω–∫–æ—é –∫–Ω–æ–ø–∫–∏ Play/Pause
        function updateButtonVisibility() {
            if (gameOver || !gameStarted) {
                // –Ø–∫—â–æ –≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∞–±–æ —â–µ –Ω–µ –ø–æ—á–∏–Ω–∞–ª–∞—Å—è, –ø–æ–∫–∞–∑—É—î–º–æ –≤–µ–ª–∏–∫—É –∫–Ω–æ–ø–∫—É "–ì—Ä–∞—Ç–∏"
                startBtn.style.display = 'block';
                playPauseBtnTop.style.display = 'none'; // –•–æ–≤–∞—î–º–æ –≤–µ—Ä—Ö–Ω—é Play/Pause
            } else if (paused) {
                // –Ø–∫—â–æ –≥—Ä–∞ –Ω–∞ –ø–∞—É–∑—ñ, –ø–æ–∫–∞–∑—É—î–º–æ –≤–µ—Ä—Ö–Ω—é –∫–Ω–æ–ø–∫—É –∑ —ñ–∫–æ–Ω–∫–æ—é "Play"
                startBtn.style.display = 'none';
                playPauseBtnTop.style.display = 'flex';
                playPauseBtnTop.classList.remove('pause-icon');
                playPauseBtnTop.classList.add('play-icon');
                playPauseBtnTop.querySelector('span').innerHTML = '&#9658;'; // –Ü–∫–æ–Ω–∫–∞ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞
                playPauseBtnTop.title = translations[currentLang]['playButtonTitle']; // –û–Ω–æ–≤–ª—é—î–º–æ title
            } else {
                // –Ø–∫—â–æ –≥—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞, –ø–æ–∫–∞–∑—É—î–º–æ –≤–µ—Ä—Ö–Ω—é –∫–Ω–æ–ø–∫—É –∑ —ñ–∫–æ–Ω–∫–æ—é "Pause"
                startBtn.style.display = 'none';
                playPauseBtnTop.style.display = 'flex';
                playPauseBtnTop.classList.remove('play-icon');
                playPauseBtnTop.classList.add('pause-icon');
                playPauseBtnTop.querySelector('span').innerHTML = '&#9646;&#9646;'; // –Ü–∫–æ–Ω–∫–∞ –¥–≤–æ—Ö –ø–∞–ª–∏—á–æ–∫
                playPauseBtnTop.title = translations[currentLang]['pauseButtonTitle']; // –û–Ω–æ–≤–ª—é—î–º–æ title
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ù–û–í–û–á –≥—Ä–∏
        function setupNewGame() {
            grid.innerHTML = '';
            tiles = [];
            for (let i = 0; i < size * size; i++) {
                const tile = document.createElement("div");
                tile.className = "tile";
                tile.dataset.val = '';
                tile.textContent = '';
                grid.appendChild(tile);
                tiles.push(tile);
            }
            addRandomTile();
            addRandomTile();
            updateScore(0);
            gameOverDisplay.textContent = ''; // –û—á–∏—â–∞—î–º–æ —Ç–µ–∫—Å—Ç "–ì—Ä—É –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
            updateTileStyles();

            paused = false; // –ì—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞ –ø—ñ—Å–ª—è –∑–∞–ø—É—Å–∫—É –Ω–æ–≤–æ—ó
            gameStarted = true; // –ì—Ä–∞ –ø–æ—á–∞–ª–∞—Å—è
            gameOver = false;
            updateButtonVisibility(); // –û–Ω–æ–≤–ª—é—î–º–æ –≤–∏–¥–∏–º—ñ—Å—Ç—å –∫–Ω–æ–ø–æ–∫
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è –≥—Ä–∏ –ø—ñ—Å–ª—è –ø–∞—É–∑–∏
        function continueGame() {
            if (gameOver || !gameStarted) return; // –ù–µ –º–æ–∂–Ω–∞ –ø—Ä–æ–¥–æ–≤–∂—É–≤–∞—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—É –∞–±–æ –Ω–µ –ø–æ—á–∞—Ç—É –≥—Ä—É
            paused = false;
            updateButtonVisibility(); // –û–Ω–æ–≤–ª—é—î–º–æ –≤–∏–¥–∏–º—ñ—Å—Ç—å –∫–Ω–æ–ø–æ–∫
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≥—Ä–∏ –Ω–∞ –ø–∞—É–∑—É
        function pauseGame() {
            if (gameOver || !gameStarted) return; // –ù–µ –º–æ–∂–Ω–∞ —Å—Ç–∞–≤–∏—Ç–∏ –Ω–∞ –ø–∞—É–∑—É –∑–∞–≤–µ—Ä—à–µ–Ω—É –∞–±–æ –Ω–µ –ø–æ—á–∞—Ç—É –≥—Ä—É
            paused = true;
            updateButtonVisibility(); // –û–Ω–æ–≤–ª—é—î–º–æ –≤–∏–¥–∏–º—ñ—Å—Ç—å –∫–Ω–æ–ø–æ–∫
        }

        function addRandomTile() {
            const empty = tiles.filter(t => t.textContent === '');
            if (empty.length === 0) return;
            const tile = empty[Math.floor(Math.random() * empty.length)];
            tile.textContent = Math.random() < 0.9 ? 2 : 4;
            updateTileStyles();
        }

        function updateTileStyles() {
            tiles.forEach(tile => {
                tile.dataset.val = tile.textContent || '';
            });
        }

        function merge(line) {
            let result = [];
            for (let i = 0; i < line.length; i++) {
                if (line[i] === null) continue;
                if (line[i] === line[i + 1]) {
                    result.push(line[i] * 2);
                    updateScore(currentScore + line[i] * 2);
                    i++;
                } else {
                    result.push(line[i]);
                }
            }
            while (result.length < size) result.push(null);
            return result;
        }

        function move(dir) {
            if (paused || gameOver) return; // –Ø–∫—â–æ –≥—Ä–∞ –Ω–∞ –ø–∞—É–∑—ñ –∞–±–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, —Ä—É—Ö –Ω–µ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è
            let moved = false;

            if (dir === 'up' || dir === 'down') {
                for (let col = 0; col < size; col++) {
                    let column = [];
                    for (let row = 0; row < size; row++) {
                        const i = row * size + col;
                        const val = parseInt(tiles[i].textContent) || null;
                        if (val) column.push(val);
                    }
                    if (dir === 'down') column.reverse();
                    const merged = merge(column);
                    if (dir === 'down') merged.reverse();
                    for (let row = 0; row < size; row++) {
                        const i = row * size + col;
                        const prev = tiles[i].textContent;
                        tiles[i].textContent = merged[row] || '';
                        if (prev !== tiles[i].textContent) moved = true;
                    }
                }
            } else {
                for (let row = 0; row < size; row++) {
                    let line = [];
                    for (let col = 0; col < size; col++) {
                        const i = row * size + col;
                        const val = parseInt(tiles[i].textContent) || null;
                        if (val) line.push(val);
                    }
                    if (dir === 'right') line.reverse();
                    const merged = merge(line);
                    if (dir === 'right') merged.reverse();
                    for (let col = 0; col < size; col++) {
                        const i = row * size + col;
                        const prev = tiles[i].textContent;
                        tiles[i].textContent = merged[col] || '';
                        if (prev !== tiles[i].textContent) moved = true;
                    }
                }
            }

            if (moved) {
                addRandomTile();
                updateTileStyles();
                if (isGameOver()) showGameOver();
            }
        }

        function isGameOver() {
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –Ω–∞ –≤–∏–≥—Ä–∞—à (2048 –ø–ª–∏—Ç–∫–∞) - —Ü–µ —Ç–∞–∫–æ–∂ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≥—Ä–∏
            if (tiles.some(tile => parseInt(tile.textContent) === 2048)) {
                // gameOverDisplay.textContent = translations[currentLang]['winMessage']; // –ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –≤–∏–≥—Ä–∞—à, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
                return true;
            }

            const copy = tiles.map(t => parseInt(t.textContent) || 0);
            for (let i = 0; i < size * size; i++) {
                if (copy[i] === 0) return false; // –Ñ –ø–æ—Ä–æ–∂–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏
                const x = i % size;
                const y = Math.floor(i / size);
                if (x < size - 1 && copy[i] === copy[i + 1]) return false; // –Ñ –º–æ–∂–ª–∏–≤—ñ —Ö–æ–¥–∏ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—ñ
                if (y < size - 1 && copy[i] === copy[i + size]) return false; // –Ñ –º–æ–∂–ª–∏–≤—ñ —Ö–æ–¥–∏ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—ñ
            }
            return true; // –ù–µ–º–∞—î –ø–æ—Ä–æ–∂–Ω—ñ—Ö –∫–ª—ñ—Ç–∏–Ω–æ–∫ —ñ –Ω–µ–º–∞—î –º–æ–∂–ª–∏–≤–∏—Ö —Ö–æ–¥—ñ–≤
        }

        function showGameOver() {
            // gameOverDisplay.textContent = translations[currentLang]['gameOverMessage']; // –¶–µ–π —Ä—è–¥–æ–∫ –ø—Ä–∏–±—Ä–∞–Ω–æ!
            gameOver = true; // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞—Ç—É—Å "–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
            paused = true; // –°—Ç–∞–≤–∏–º–æ –≥—Ä—É –Ω–∞ –ø–∞—É–∑—É
            gameStarted = false; // –ì—Ä–∞ –±—ñ–ª—å—à–µ –Ω–µ –≤–≤–∞–∂–∞—î—Ç—å—Å—è "–ø–æ—á–∞—Ç–æ—é" (–¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–Ω–æ–ø–∫–∞–º–∏)
            updateButtonVisibility(); // –û–Ω–æ–≤–ª—é—î–º–æ –≤–∏–¥–∏–º—ñ—Å—Ç—å –∫–Ω–æ–ø–æ–∫
        }

        function updateScore(score = 0) {
            currentScore = score;
            scoreDisplay.textContent = currentScore;
            const best = Math.max(score, parseInt(localStorage.getItem("best") || 0));
            localStorage.setItem("best", best);
            bestDisplay.textContent = best;
        }

        // –û–±—Ä–æ–±–Ω–∏–∫ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –∫–ª–∞–≤—ñ—à
        document.addEventListener("keydown", e => {
            if (paused || gameOver) return;
            if (e.key === "ArrowUp" || e.key === "w" || e.key === "W") move("up");
            if (e.key === "ArrowDown" || e.key === "s" || e.key === "S") move("down");
            if (e.key === "ArrowLeft" || e.key === "a" || e.key === "A") move("left");
            if (e.key === "ArrowRight" || e.key === "d" || e.key === "D") move("right");
        });

        // –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Å–≤–∞–π–ø—ñ–≤
        let startX, startY;
        document.addEventListener("touchstart", e => {
            if (paused || gameOver) return; // –ù–µ —Ä–µ–∞–≥—É—î–º–æ –Ω–∞ —Å–≤–∞–π–ø–∏, —è–∫—â–æ –≥—Ä–∞ –Ω–∞ –ø–∞—É–∑—ñ/–∑–∞–≤–µ—Ä—à–µ–Ω–∞
            const touch = e.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;
        });

        document.addEventListener("touchend", e => {
            if (paused || gameOver) return; // –ù–µ —Ä–µ–∞–≥—É—î–º–æ –Ω–∞ —Å–≤–∞–π–ø–∏, —è–∫—â–æ –≥—Ä–∞ –Ω–∞ –ø–∞—É–∑—ñ/–∑–∞–≤–µ—Ä—à–µ–Ω–∞
            const touch = e.changedTouches[0];
            const dx = touch.clientX - startX;
            const dy = touch.clientY - startY;
            if (Math.abs(dx) > Math.abs(dy)) {
                if (dx > 30) move("right");
                else if (dx < -30) move("left");
            } else {
                if (dy > 30) move("down");
                else if (dy < -30) move("up");
            }
        });

        // JS –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ç–∞ –º–æ–¥–∞–ª–æ–∫
        const rulesBtn = document.getElementById('rulesBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const controlsBtn = document.getElementById('controlsBtn');

        const rulesModal = document.getElementById('rulesModal');
        const settingsModal = document.getElementById('settingsModal');
        const controlsModal = document.getElementById('controlsModal');

        const langBtn = document.getElementById('langBtn');
        const langPopup = document.getElementById('langPopup');

        const themeBtn = document.getElementById('themeBtn');
        const themePopup = document.getElementById('themePopup');

        const controlsBackBtn = document.getElementById('controlsBackBtn');

        // –ú–æ–≤–Ω—ñ —Å–ª–æ–≤–Ω–∏–∫–∏
        const translations = {
            uk: {
                gameTitle: "NoneUp",
                scoreLabel: "–û—á–∫–∏",
                bestLabel: "–†–µ–∫–æ—Ä–¥",
                startButton: "–ì—Ä–∞—Ç–∏", // –î–ª—è –ø–æ—á–∞—Ç–∫—É –Ω–æ–≤–æ—ó –≥—Ä–∏ (–Ω–∏–∂–Ω—è –∫–Ω–æ–ø–∫–∞)
                playButtonTitle: "–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏", // Title –¥–ª—è –≤–µ—Ä—Ö–Ω—å–æ—ó –∫–Ω–æ–ø–∫–∏ Play
                pauseButtonTitle: "–ü–∞—É–∑–∞", // Title –¥–ª—è –≤–µ—Ä—Ö–Ω—å–æ—ó –∫–Ω–æ–ø–∫–∏ Pause
                gameOverMessage: "–ì—Ä—É –∑–∞–≤–µ—Ä—à–µ–Ω–æ!", // –ó–∞–ª–∏—à–µ–Ω–æ, —è–∫—â–æ –≤–∏ –∑–∞—Ö–æ—á–µ—Ç–µ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ —Ü–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
                winMessage: "–í–∏ –≤–∏–≥—Ä–∞–ª–∏!üéâ",
                rulesButton: "–ü—Ä–∞–≤–∏–ª–∞",
                settingsButtonTitle: "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è",
                rulesTitle: "–ü—Ä–∞–≤–∏–ª–∞ –≥—Ä–∏ 2048",
                pcLabel: "–ù–∞ –ü–ö:",
                pcControls: "–∫–µ—Ä—É–π –≥—Ä–æ—é –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å—Ç—Ä—ñ–ª–æ–∫: ‚Üê ‚Üë ‚Üí ‚Üì –∞–±–æ WASD.",
                phoneLabel: "–ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—ñ:",
                phoneControls: "–∫–µ—Ä—É–π –≥—Ä–æ—é —Å–≤–∞–π–ø–∞–º–∏ –≤–≥–æ—Ä—É, –≤–Ω–∏–∑, –≤–ª—ñ–≤–æ —Ç–∞ –≤–ø—Ä–∞–≤–æ.",
                gameGoal: "–ó'—î–¥–Ω—É–π –æ–¥–Ω–∞–∫–æ–≤—ñ —á–∏—Å–ª–∞, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ 2048 —ñ –≤–∏–≥—Ä–∞—Ç–∏ –≥—Ä—É!",
                settingsTitle: "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è",
                controlsButton: "–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è",
                languageButton: "–ú–æ–≤–∞ ‚ñº",
                themeButton: "–¢–µ–º–∞ ‚ñº",
                darkTheme: "–¢–µ–º–Ω–∞ —Ç–µ–º–∞",
                lightTheme: "–°–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞",
                controlsTitle: "–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è",
                arrows: "–°—Ç—Ä—ñ–ª–∫–∏: ‚Üê ‚Üë ‚Üí ‚Üì",
                swipes: "–°–≤–∞–π–ø–∏ –≤–≥–æ—Ä—É, –≤–Ω–∏–∑, –≤–ª—ñ–≤–æ, –≤–ø—Ä–∞–≤–æ",
                closeButton: "–ó–∞–∫—Ä–∏—Ç–∏",
                backButton: "–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è",
            },
            en: {
                gameTitle: "NoneUp",
                scoreLabel: "Score",
                bestLabel: "Best",
                startButton: "Play",
                playButtonTitle: "Continue",
                pauseButtonTitle: "Pause",
                gameOverMessage: "Game Over!",
                winMessage: "You won!üéâ",
                rulesButton: "Rules",
                settingsButtonTitle: "Settings",
                rulesTitle: "2048 Game Rules",
                pcLabel: "On PC:",
                pcControls: "control the game using arrow keys: ‚Üê ‚Üë ‚Üí ‚Üì or WASD.",
                phoneLabel: "On Phone:",
                phoneControls: "control the game with swipes up, down, left, and right.",
                gameGoal: "Combine identical numbers to get 2048 and win the game!",
                settingsTitle: "Settings",
                controlsButton: "Controls",
                languageButton: "Language ‚ñº",
                themeButton: "Theme ‚ñº",
                darkTheme: "Dark Theme",
                lightTheme: "Light Theme",
                controlsTitle: "Controls",
                arrows: "Arrows: ‚Üê ‚Üë ‚Üí ‚Üì",
                swipes: "Swipes up, down, left, right",
                closeButton: "Close",
                backButton: "Back",
            },
            ja: {
                gameTitle: "NoneUp",
                scoreLabel: "„Çπ„Ç≥„Ç¢",
                bestLabel: "ÊúÄÈ´òË®òÈå≤",
                startButton: "„Éó„É¨„Ç§",
                playButtonTitle: "Á∂öË°å",
                pauseButtonTitle: "‰∏ÄÊôÇÂÅúÊ≠¢",
                gameOverMessage: "„Ç≤„Éº„É†„Ç™„Éº„Éê„ÉºÔºÅ",
                winMessage: "ÂãùÂà©„Åó„Åæ„Åó„ÅüÔºÅüéâ",
                rulesButton: "„É´„Éº„É´",
                settingsButtonTitle: "Ë®≠ÂÆö",
                rulesTitle: "2048„Ç≤„Éº„É†„ÅÆ„É´„Éº„É´",
                pcLabel: "PC„Åß:",
                pcControls: "Áü¢Âç∞„Ç≠„Éº: ‚Üê ‚Üë ‚Üí ‚Üì „Åæ„Åü„ÅØ WASD „Åß„Ç≤„Éº„É†„ÇíÊìç‰Ωú„Åó„Åæ„Åô„ÄÇ",
                phoneLabel: "„Çπ„Éû„Éº„Éà„Éï„Ç©„É≥„Åß:",
                phoneControls: "‰∏ä‰∏ãÂ∑¶Âè≥„Å´„Çπ„ÉØ„Ç§„Éó„Åó„Å¶„Ç≤„Éº„É†„ÇíÊìç‰Ωú„Åó„Åæ„Åô„ÄÇ",
                gameGoal: "Âêå„ÅòÊï∞Â≠ó„ÇíÁµêÂêà„Åó„Å¶2048„Çí‰Ωú„Çä„ÄÅ„Ç≤„Éº„É†„Å´ÂãùÂà©„Åó„Åæ„Åó„Çá„ÅÜÔºÅ",
                settingsTitle: "Ë®≠ÂÆö",
                controlsButton: "Êìç‰ΩúÊñπÊ≥ï",
                languageButton: "Ë®ÄË™û ‚ñº",
                themeButton: "„ÉÜ„Éº„Éû ‚ñº",
                darkTheme: "„ÉÄ„Éº„ÇØ„ÉÜ„Éº„Éû",
                lightTheme: "„É©„Ç§„Éà„ÉÜ„Éº„Éû",
                controlsTitle: "Êìç‰ΩúÊñπÊ≥ï",
                arrows: "Áü¢Âç∞: ‚Üê ‚Üë ‚Üí ‚Üì",
                swipes: "‰∏ä‰∏ãÂ∑¶Âè≥„ÅÆ„Çπ„ÉØ„Ç§„Éó",
                closeButton: "Èñâ„Åò„Çã",
                backButton: "Êàª„Çã",
            },
            zh: {
                gameTitle: "NoneUp",
                scoreLabel: "ÂàÜÊï∞",
                bestLabel: "ÊúÄÈ´òÂàÜ",
                startButton: "ÂºÄÂßã",
                playButtonTitle: "ÁªßÁª≠",
                pauseButtonTitle: "ÊöÇÂÅú",
                gameOverMessage: "Ê∏∏ÊàèÁªìÊùüÔºÅ",
                winMessage: "‰Ω†Ëµ¢‰∫ÜÔºÅüéâ",
                rulesButton: "ËßÑÂàô",
                settingsButtonTitle: "ËÆæÁΩÆ",
                rulesTitle: "2048Ê∏∏ÊàèËßÑÂàô",
                pcLabel: "Âú®ÁîµËÑë‰∏ä:",
                pcControls: "‰ΩøÁî®ÊñπÂêëÈîÆÔºö‚Üê ‚Üë ‚Üí ‚Üì Êàñ WASD ÊéßÂà∂Ê∏∏Êàè„ÄÇ",
                phoneLabel: "Âú®ÊâãÊú∫‰∏ä:",
                phoneControls: "Âêë‰∏ä„ÄÅÂêë‰∏ã„ÄÅÂêëÂ∑¶„ÄÅÂêëÂè≥ÊªëÂä®Â±èÂπïÊù•ÊéßÂà∂Ê∏∏Êàè„ÄÇ",
                gameGoal: "ÂêàÂπ∂Áõ∏ÂêåÁöÑÊï∞Â≠ó‰ª•ËææÂà∞2048Âπ∂Ëµ¢ÂæóÊ∏∏ÊàèÔºÅ",
                settingsTitle: "ËÆæÁΩÆ",
                controlsButton: "ÊéßÂà∂",
                languageButton: "ËØ≠Ë®Ä ‚ñº",
                themeButton: "‰∏ªÈ¢ò ‚ñº",
                darkTheme: "Ê∑±Ëâ≤‰∏ªÈ¢ò",
                lightTheme: "ÊµÖËâ≤‰∏ªÈ¢ò",
                controlsTitle: "ÊéßÂà∂",
                arrows: "ÊñπÂêëÈîÆÔºö‚Üê ‚Üë ‚Üí ‚Üì",
                swipes: "Âêë‰∏ä„ÄÅÂêë‰∏ã„ÄÅÂêëÂ∑¶„ÄÅÂêëÂè≥ÊªëÂä®",
                closeButton: "ÂÖ≥Èó≠",
                backButton: "ËøîÂõû",
            }
        };

        let currentLang = 'uk'; // –ú–æ–≤–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ
        function updateTextsForLanguage() {
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                if (translations[currentLang] && translations[currentLang][key]) {
                    element.textContent = translations[currentLang][key];
                }
            });

            // –û–Ω–æ–≤–ª—é—î–º–æ –∞—Ç—Ä–∏–±—É—Ç–∏ title –¥–ª—è –≤–µ—Ä—Ö–Ω—ñ—Ö –∫–Ω–æ–ø–æ–∫
            settingsBtn.title = translations[currentLang]['settingsButtonTitle'];
            // playPauseBtnTop.title –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ updateButtonVisibility()
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –∞—Ç—Ä–∏–±—É—Ç aria-label –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∑–∞–∫—Ä–∏—Ç—Ç—è
            // controlsBackBtn —Ç–µ–ø–µ—Ä –Ω–µ –º–∞—î –∫–ª–∞—Å—É close-btn, —Ç–æ–º—É —ó—ó title –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è –æ–∫—Ä–µ–º–æ
            document.querySelectorAll('.close-btn').forEach(btn => {
                btn.setAttribute('aria-label', translations[currentLang]['closeButton']);
            });
            controlsBackBtn.setAttribute('aria-label', translations[currentLang]['backButton']); // –û–±—Ä–æ–±–∫–∞ –¥–ª—è controlsBackBtn –æ–∫—Ä–µ–º–æ


            // –û–Ω–æ–≤–ª—é—î–º–æ —Ä–µ–∫–æ—Ä–¥ –ø—Ä–∏ –∑–º—ñ–Ω—ñ –º–æ–≤–∏, —â–æ–± –≤—ñ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞–≤—Å—è
            bestDisplay.textContent = localStorage.getItem("best") || 0;
            updateScore(currentScore);
            // gameOverDisplay –Ω–µ –æ–Ω–æ–≤–ª—é—î–º–æ —Ç—É—Ç, –π–æ–≥–æ —Ç–µ–∫—Å—Ç –∫–µ—Ä—É—î—Ç—å—Å—è –ª–æ–≥—ñ–∫–æ—é –≥—Ä–∏

            // –û–Ω–æ–≤–ª—é—î–º–æ –≤–∏–¥–∏–º—ñ—Å—Ç—å –∫–Ω–æ–ø–æ–∫ –ø—ñ—Å–ª—è –∑–º—ñ–Ω–∏ –º–æ–≤–∏, —â–æ–± title —Ç–∞ —ñ–∫–æ–Ω–∫–∏ –±—É–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ
            updateButtonVisibility();
        }

        // === –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ Play/Pause/Start ===

        // –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –≤–µ–ª–∏–∫–æ—ó –∫–Ω–æ–ø–∫–∏ "–ì—Ä–∞—Ç–∏" (–≤–Ω–∏–∑—É)
        startBtn.addEventListener('click', () => {
            setupNewGame(); // –ó–∞–≤–∂–¥–∏ –ø–æ—á–∏–Ω–∞—î –Ω–æ–≤—É –≥—Ä—É
        });

        // –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –≤–µ—Ä—Ö–Ω—å–æ—ó –∫–Ω–æ–ø–∫–∏ Play/Pause
        playPauseBtnTop.addEventListener('click', () => {
            if (paused) {
                continueGame(); // –Ø–∫—â–æ –Ω–∞ –ø–∞—É–∑—ñ, –ø—Ä–æ–¥–æ–≤–∂—É—î–º–æ
            } else {
                pauseGame(); // –Ø–∫—â–æ –≥—Ä–∞—î–º–æ, —Å—Ç–∞–≤–∏–º–æ –Ω–∞ –ø–∞—É–∑—É
            }
        });
        // =======================================================


        // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤—É –º–æ–≤—É —Ç–∞ –≤–∏–¥–∏–º—ñ—Å—Ç—å –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        updateTextsForLanguage();
        // setupNewGame() –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î–º–æ —Ç—É—Ç, —â–æ–± –≥—Ä–∞ –Ω–µ –ø–æ—á–∏–Ω–∞–ª–∞—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ


        // === –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π –¥–ª—è –º–æ–¥–∞–ª–æ–∫ ===

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–∫—Ä–∏—Ç—Ç—è –≤—Å—ñ—Ö –æ—Å–Ω–æ–≤–Ω–∏—Ö –º–æ–¥–∞–ª–æ–∫
        function closeAllModals() {
            rulesModal.style.display = 'none';
            settingsModal.style.display = 'none';
            controlsModal.style.display = 'none';
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–∫—Ä–∏—Ç—Ç—è –≤—Å—ñ—Ö –º—ñ–Ω—ñ-–ø–æ–ø–∞–ø—ñ–≤ (–º–æ–≤–∞, —Ç–µ–º–∞)
        function closeAllPopups() {
            langPopup.style.display = 'none';
            themePopup.style.display = 'none';
        }

        // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –ü—Ä–∞–≤–∏–ª
        rulesBtn.onclick = () => {
            closeAllModals(); // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –≤—Å—ñ –æ—Å–Ω–æ–≤–Ω—ñ –º–æ–¥–∞–ª–∫–∏
            closeAllPopups(); // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –≤—Å—ñ –º—ñ–Ω—ñ-–ø–æ–ø–∞–ø–∏
            rulesModal.style.display = 'flex';
        };

        // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
        settingsBtn.onclick = () => {
            closeAllModals(); // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –≤—Å—ñ –æ—Å–Ω–æ–≤–Ω—ñ –º–æ–¥–∞–ª–∫–∏
            closeAllPopups(); // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –≤—Å—ñ –º—ñ–Ω—ñ-–ø–æ–ø–∞–ø–∏
            settingsModal.style.display = 'flex';
        };

        // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
        controlsBtn.onclick = () => {
            closeAllPopups(); // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º—ñ–Ω—ñ-–ø–æ–ø–∞–ø–∏, —è–∫—â–æ –≤—ñ–¥–∫—Ä–∏—Ç—ñ
            settingsModal.style.display = 'none';
            controlsModal.style.display = 'flex';
        };

        // –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∑ –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–æ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
        controlsBackBtn.onclick = (e) => {
            e.stopPropagation(); // –í–∞–∂–ª–∏–≤–æ: –∑—É–ø–∏–Ω—è—î–º–æ –ø–æ—à–∏—Ä–µ–Ω–Ω—è –ø–æ–¥—ñ—ó, —â–æ–± –Ω–µ –∑–∞–∫—Ä–∏—Ç–∏ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫—É –º–æ–¥–∞–ª–∫—É
            controlsModal.style.display = 'none';
            settingsModal.style.display = 'flex';
        };

        // –ó–∞–∫—Ä–∏—Ç—Ç—è –ø–æ –∫–Ω–æ–ø–∫–∞—Ö –∑–∞–∫—Ä–∏—Ç—Ç—è (—Ö—Ä–µ—Å—Ç–∏–∫–∏) - –¢–ï–ü–ï–† –¢–Ü–õ–¨–ö–ò –î–õ–Ø –°–ü–†–ê–í–ñ–ù–Ü–• –•–†–ï–°–¢–ò–ö–Ü–í
        document.querySelectorAll('.close-btn').forEach(btn => {
            btn.onclick = e => {
                e.target.closest('.modal-overlay').style.display = 'none';
                closeAllPopups(); // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º—ñ–Ω—ñ-–ø–æ–ø–∞–ø–∏ –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ –æ—Å–Ω–æ–≤–Ω–∏—Ö –º–æ–¥–∞–ª–æ–∫
            };
        });

        // –ó–∞–∫—Ä–∏—Ç—Ç—è –ø–æ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –º–æ–¥–∞–ª–∫–æ—é
        [rulesModal, settingsModal, controlsModal].forEach(modal => {
            modal.onclick = e => {
                if(e.target === modal) {
                    modal.style.display = 'none';
                    closeAllPopups(); // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º—ñ–Ω—ñ-–ø–æ–ø–∞–ø–∏, —è–∫—â–æ –∫–ª–∞—Ü–Ω—É–ª–∏ –ø–æ–∑–∞ –º–æ–¥–∞–ª–∫–æ—é
                }
            };
        });

        // –ü–æ–∫–∞–∑/–ø—Ä–∏—Ö–æ–≤–∞–Ω–Ω—è –º—ñ–Ω—ñ-–º–µ–Ω—é (–ú–æ–≤–∞, –¢–µ–º–∞)
        langBtn.onclick = e => {
            e.stopPropagation(); // –ó—É–ø–∏–Ω—è—î–º–æ –ø–æ—à–∏—Ä–µ–Ω–Ω—è, —â–æ–± –∫–ª—ñ–∫ –ø–æ –∫–Ω–æ–ø—Ü—ñ –Ω–µ –∑–∞–∫—Ä–∏–≤ –ø–æ–ø–∞–ø –æ–¥—Ä–∞–∑—É
            if (langPopup.style.display === 'flex') {
                langPopup.style.display = 'none';
            } else {
                closeAllPopups(); // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ —ñ–Ω—à—ñ –ø–æ–ø–∞–ø–∏ (—è–∫—â–æ —î)
                langPopup.style.display = 'flex';
            }
        };

        themeBtn.onclick = e => {
            e.stopPropagation(); // –ó—É–ø–∏–Ω—è—î–º–æ –ø–æ—à–∏—Ä–µ–Ω–Ω—è, —â–æ–± –∫–ª—ñ–∫ –ø–æ –∫–Ω–æ–ø—Ü—ñ –Ω–µ –∑–∞–∫—Ä–∏–≤ –ø–æ–ø–∞–ø –æ–¥—Ä–∞–∑—É
            if (themePopup.style.display === 'flex') {
                themePopup.style.display = 'none';
            } else {
                closeAllPopups(); // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ —ñ–Ω—à—ñ –ø–æ–ø–∞–ø–∏ (—è–∫—â–æ —î)
                themePopup.style.display = 'flex';
            }
        };

        // –ó–∞–∫—Ä–∏—Ç–∏ –º—ñ–Ω—ñ-–º–µ–Ω—é –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –Ω–∏–º–∏
        document.body.addEventListener('click', () => {
            closeAllPopups();
        });

        // –û–±—Ä–æ–±–∫–∞ –≤–∏–±–æ—Ä—É –º–æ–≤–∏
        langPopup.querySelectorAll('button').forEach(btn => {
            btn.onclick = e => {
                currentLang = e.target.getAttribute('data-lang');
                updateTextsForLanguage(); // –í–∏–∫–ª–∏–∫–∞—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—Å—ñ—Ö —Ç–µ–∫—Å—Ç—ñ–≤
                closeAllPopups(); // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –ø–æ–ø–∞–ø –º–æ–≤–∏
            };
        });

        // –û–±—Ä–æ–±–∫–∞ –≤–∏–±–æ—Ä—É —Ç–µ–º–∏
        themePopup.querySelectorAll('button').forEach(btn => {
            btn.onclick = e => {
                const theme = e.target.getAttribute('data-theme');
                if(theme === 'light') {
                    document.body.classList.add('light');
                } else {
                    document.body.classList.remove('light');
                }
                closeAllPopups(); // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –ø–æ–ø–∞–ø —Ç–µ–º–∏
            };
        });
    </script>

</body>
</html>